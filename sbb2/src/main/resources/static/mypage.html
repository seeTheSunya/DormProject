<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´í˜ì´ì§€ - ë„ë€</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <style>
        /* â˜…â˜…â˜… í…Œë§ˆë³„ ìƒ‰ìƒ ì •ì˜ â˜…â˜…â˜… */
        body.theme-light { background-color: #f3f4f6; color: #1f2937; }
        body.theme-dark { background-color: #111827; color: #e5e7eb; }
        body.theme-dark .bg-white { background-color: #1f2937 !important; border-color: #374151; color: #e5e7eb; }
        body.theme-dark .text-gray-800 { color: #f3f4f6 !important; }
        body.theme-dark .text-gray-600 { color: #9ca3af !important; }
        body.theme-dark .text-gray-500 { color: #9ca3af !important; }
        body.theme-blue { background-color: #f7faf9; color: #5a7a72; }
        body.theme-blue .bg-white { background-color: #eaf5f2 !important; }
        body.theme-pink { background-color: #fef5f0; color: #b85d4a; }
        body.theme-pink .bg-white { background-color: #fce8df !important; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-xl w-96">
            <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</h1>
            
            <div class="mb-6 text-center">
                <p class="text-gray-600">ì•ˆë…•í•˜ì„¸ìš”,</p>
                <p class="text-xl font-bold text-blue-600">{{ loggedInUser }}ë‹˜!</p>
            </div>

            <hr class="mb-6 border-gray-200">

            <h2 class="text-lg font-bold text-red-600 mb-4">âš ï¸ íšŒì› íƒˆí‡´</h2>
            <p class="text-sm text-gray-500 mb-4">íƒˆí‡´ ì‹œ ì‘ì„±í•œ ê¸€ê³¼ ëŒ“ê¸€ì€ ìœ ì§€ë˜ì§€ë§Œ, íšŒì› ì •ë³´ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>

            <form @submit.prevent="withdraw">
                <div class="mb-4">
                    <label class="block mb-1 text-sm font-bold text-gray-600">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" v-model="password" class="w-full border p-2 rounded focus:ring-2 focus:ring-red-500 outline-none" placeholder="ë³¸ì¸ í™•ì¸ì„ ìœ„í•´ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <button type="submit" class="w-full bg-red-500 text-white font-bold py-2 rounded hover:bg-red-600 mb-3 transition">íƒˆí‡´í•˜ê¸°</button>
            </form>
            
            <div class="mt-4 text-center">
                <a href="/main.html" class="text-sm text-gray-500 hover:underline">&larr; ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loggedInUser: localStorage.getItem('loggedInUser'),
                    password: ''
                }
            },
            mounted() {
                // â˜…â˜…â˜… í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í…Œë§ˆ ë¶ˆëŸ¬ì˜¤ê¸° â˜…â˜…â˜…
                const savedTheme = localStorage.getItem('userTheme') || 'light';
                document.body.className = `theme-${savedTheme}`;
                
                if (!this.loggedInUser) {
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                    try {
                        window.location.href = '/login.html';
                    } catch (e) {
                        console.warn("í˜ì´ì§€ ì´ë™ ì¤‘ ì˜¤ë¥˜ ë°œìƒ (í”„ë¦¬ë·° í™˜ê²½):", e);
                    }
                }
            },
            methods: {
                async withdraw() {
                    if (!confirm("ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;

                    try {
                        await axios.post('http://localhost:8080/api/withdraw', {
                            username: this.loggedInUser,
                            password: this.password
                        });
                        
                        alert('íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.');
                        localStorage.removeItem('loggedInUser'); // ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œ
                        try {
                            window.location.href = '/main.html'; // ë©”ì¸ìœ¼ë¡œ ì´ë™
                        } catch (e) {
                            console.warn("í˜ì´ì§€ ì´ë™ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
                        }
                        
                    } catch (error) {
                        alert("íƒˆí‡´ ì‹¤íŒ¨: " + (error.response?.data || "ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."));
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>