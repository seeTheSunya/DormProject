<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>로그인</title>
  <link rel="stylesheet" href="/assets/doran.css">
</head>
<body>
  <div class="auth-page">
    <div class="auth-card">

      <h2 class="card-title">로그인</h2>

      <form class="form" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="label">아이디</label>
          <input id="login-username" class="input" required>
        </div>

        <div class="form-group">
          <label class="label">비밀번호</label>
          <input id="login-password" class="input" type="password" required>
        </div>

        <button class="btn btn-primary btn-block">로그인</button>
        <div id="loginMessage" class="message"></div>
      </form>

      <div class="footer-text">
        5분간 입력이 없으면 자동으로 새로고침됩니다
      </div>

      <div style="margin-top:20px; text-align:center;">
        <a href="signup.html">회원가입</a> · 
        <a href="find-password.html">비밀번호 찾기</a>
      </div>

    </div>
  </div>

  <script>
    /* 로그인 */
    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;
      const msg = document.getElementById("loginMessage");

      msg.textContent = "";

      const res = await fetch("/api/login", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({username, password})
      });

      if (!res.ok) {
        msg.textContent = "아이디 또는 비밀번호가 틀렸습니다.";
        msg.className = "message message-error";
        return;
      }

      const data = await res.json();

      // 임시비번?
      if (data.mustChangePassword) {
        location.href = "change-password.html";
        return;
      }

      // 로그인 성공 → 메인으로 이동
      localStorage.setItem("loginUser", data.username);
      location.href = "main.html";
    }

    // 5분 후 자동 새로고침
    setTimeout(() => location.reload(), 5 * 60 * 1000);
  </script>
</body>
</html>
