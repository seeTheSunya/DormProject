<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Vue.js CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>ê²Œì‹œíŒ</title>
    <style>
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* [ê³µí†µ ë ˆì´ì•„ì›ƒ ë¯¸ì„¸ ì¡°ì •] */
        input:focus { outline: none; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); }

        /* ------------------------------------------------------------------
           1. ğŸŒ ë¼ì´íŠ¸ ëª¨ë“œ (ê¸°ë³¸)
           ------------------------------------------------------------------ */
        body.theme-light { background-color: #f3f4f6; color: #1f2937; }
        body.theme-light header { background-color: #ffffff; border-bottom: 1px solid #e5e7eb; }
        body.theme-light .home-link { color: #1f2937; }
        body.theme-light .user-text { color: #4b5563; }
        body.theme-light .logout-btn { background-color: #e5e7eb; color: #374151; }
        body.theme-light .logout-btn:hover { background-color: #d1d5db; }
        body.theme-light header select { background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        
        body.theme-light .board-container { background-color: #ffffff; border: 1px solid #e5e7eb; }
        
        /* â˜… [ìˆ˜ì •] ê²Œì‹œíŒ í—¤ë” ë°°ê²½ì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½, ê¸€ììƒ‰ì€ ê²€ì •ìœ¼ë¡œ ë³€ê²½ */
        body.theme-light .board-header { background-color: #ffffff; color: #1f2937; border-bottom: 1px solid #e5e7eb; }
        body.theme-light .board-header h2 { color: #1f2937; } /* ì œëª© ê¸€ììƒ‰ë„ ê²€ì •ìœ¼ë¡œ */
        
        body.theme-light .board-header input { background-color: #ffffff; color: #1f2937; border: 1px solid #e5e7eb; }
        body.theme-light .board-header .search-btn { background-color: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; }
        
        body.theme-light table thead { background-color: #f9fafb; color: #4b5563; border-bottom: 1px solid #e5e7eb; }
        body.theme-light table tbody tr { border-bottom: 1px solid #e5e7eb; }
        body.theme-light table tbody tr:hover { background-color: #f9fafb; }
        body.theme-light table td { color: #1f2937; }
        body.theme-light .text-sub { color: #6b7280; }


        /* ------------------------------------------------------------------
           2. ğŸŒ™ ë‹¤í¬ ëª¨ë“œ
           ------------------------------------------------------------------ */
        body.theme-dark { background-color: #111827; color: #e5e7eb; }
        body.theme-dark header { background-color: #1f2937; border-bottom: 1px solid #374151; }
        body.theme-dark .home-link { color: #ffffff; }
        body.theme-dark .user-text { color: #d1d5db; }
        body.theme-dark .logout-btn { background-color: #374151; color: #e5e7eb; }
        body.theme-dark .logout-btn:hover { background-color: #4b5563; }
        body.theme-dark header select { background-color: #374151; color: #e5e7eb; border: 1px solid #4b5563; }

        body.theme-dark .board-container { background-color: #1f2937; border: 1px solid #374151; }
        body.theme-dark .board-header { background-color: #374151; color: #ffffff; border-bottom: 1px solid #4b5563; }
        body.theme-dark .board-header input { background-color: #111827; color: #e5e7eb; border: 1px solid #4b5563; }
        body.theme-dark .board-header .search-btn { background-color: #4b5563; color: #e5e7eb; border: 1px solid #6b7280; }

        body.theme-dark table thead { background-color: #374151; color: #d1d5db; border-bottom: 1px solid #4b5563; }
        body.theme-dark table tbody tr { border-bottom: 1px solid #374151; }
        body.theme-dark table tbody tr:hover { background-color: #374151; }
        body.theme-dark table td { color: #e5e7eb; }
        body.theme-dark .text-sub { color: #9ca3af; }


        /* ------------------------------------------------------------------
           3. ğŸŒ¿ ë¯¼íŠ¸(Blue) ëª¨ë“œ
           ------------------------------------------------------------------ */
        body.theme-blue { background-color: #f7faf9; color: #5a7a72; }
        body.theme-blue header { background-color: #eaf5f2; border-bottom: 1px solid #bce3d4; }
        body.theme-blue .home-link { color: #5a7a72; }
        body.theme-blue .user-text { color: #3e5c54; }
        body.theme-blue .logout-btn { background-color: #ffffff; color: #5a7a72; border: 1px solid #bce3d4; }
        body.theme-blue .logout-btn:hover { background-color: #d1fae5; }
        body.theme-blue header select { background-color: #ffffff; color: #5a7a72; border: 1px solid #bce3d4; }

        body.theme-blue .board-container { background-color: #ffffff; border: 1px solid #bce3d4; }
        body.theme-blue .board-header { background-color: #5a7a72; color: #ffffff; border-bottom: 1px solid #bce3d4; }
        body.theme-blue .board-header input { background-color: #ffffff; color: #5a7a72; border: 1px solid #bce3d4; }
        body.theme-blue .board-header .search-btn { background-color: #eaf5f2; color: #5a7a72; border: 1px solid #bce3d4; }

        body.theme-blue table thead { background-color: #eaf5f2; color: #5a7a72; border-bottom: 1px solid #bce3d4; }
        body.theme-blue table tbody tr { border-bottom: 1px solid #e2e8f0; }
        body.theme-blue table tbody tr:hover { background-color: #f0fdf4; }
        body.theme-blue table td { color: #2c3e50; }
        body.theme-blue .text-sub { color: #5a7a72; opacity: 0.8; }


        /* ------------------------------------------------------------------
           4. ğŸŒ¸ ë²šê½ƒ(Pink) ëª¨ë“œ
           ------------------------------------------------------------------ */
        body.theme-pink { background-color: #fef5f0; color: #b85d4a; }
        body.theme-pink header { background-color: #fce8df; border-bottom: 1px solid #fed7aa; }
        body.theme-pink .home-link { color: #b85d4a; }
        body.theme-pink .user-text { color: #9c4232; }
        body.theme-pink .logout-btn { background-color: #ffffff; color: #b85d4a; border: 1px solid #fecaca; }
        body.theme-pink .logout-btn:hover { background-color: #ffe4e6; }
        body.theme-pink header select { background-color: #ffffff; color: #b85d4a; border: 1px solid #fed7aa; }

        body.theme-pink .board-container { background-color: #ffffff; border: 1px solid #fed7aa; }
        body.theme-pink .board-header { background-color: #d66a58; color: #ffffff; border-bottom: 1px solid #fed7aa; }
        body.theme-pink .board-header input { background-color: #ffffff; color: #b85d4a; border: 1px solid #fed7aa; }
        body.theme-pink .board-header .search-btn { background-color: #fff1f2; color: #d66a58; border: 1px solid #fed7aa; }

        body.theme-pink table thead { background-color: #fff1f2; color: #b85d4a; border-bottom: 1px solid #fed7aa; }
        body.theme-pink table tbody tr { border-bottom: 1px solid #ffe4e6; }
        body.theme-pink table tbody tr:hover { background-color: #fff1f2; }
        body.theme-pink table td { color: #4a0e0e; }
        body.theme-pink .text-sub { color: #b85d4a; opacity: 0.8; }

        /* ë²šê½ƒ íš¨ê³¼ */
        .cherry-blossom {
            position: fixed; top: -10px; background-color: #FFB7C5;
            border-radius: 150% 0 150% 0; pointer-events: none; z-index: 9999;
            opacity: 0.8; animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg) translateX(0); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg) translateX(50px); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="shadow-sm sticky top-0 z-10 transition-colors duration-300">
            <div class="container mx-auto px-6 py-4 flex items-center justify-between">
                <a href="main.html" class="home-link text-2xl font-bold hover:opacity-80 transition flex items-center gap-2">
                    ğŸ  <span>ë„ë€ ({{ categoryTitle }})</span>
                </a>
                
                <div class="flex items-center space-x-4">
                    <!-- â˜… í…Œë§ˆ ì„ íƒ ë°•ìŠ¤ -->
                    <select v-model="currentTheme" @change="changeTheme(currentTheme)" 
                            class="p-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors cursor-pointer border">
                        <option value="light">ğŸŒ ë¼ì´íŠ¸</option>
                        <option value="dark">ğŸŒ™ ë‹¤í¬</option>
                        <option value="blue">ğŸŒ¿ ë¯¼íŠ¸</option>
                        <option value="pink">ğŸŒ¸ ë²šê½ƒ</option>
                    </select>

                    <div v-if="loggedInUser" class="flex items-center space-x-3">
                        <span class="user-text font-bold">{{ loggedInUser }}ë‹˜</span>
                        <button @click="logout" class="logout-btn font-semibold px-4 py-2 rounded transition">
                            ë¡œê·¸ì•„ì›ƒ
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto p-4 md:p-6 pb-12">
            <!-- â˜… ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš° (ì£¼ì„ í•´ì œ ë° í…Œë§ˆ ì ìš©) -->
            <div v-if="!loggedInUser" class="flex flex-col items-center justify-center py-20 text-center animate-fade-in-up">
                <div class="board-container p-10 rounded-xl shadow-md max-w-lg w-full">
                    <div class="text-6xl mb-4">ğŸ”’</div>
                    <h2 class="text-2xl font-bold mb-2">ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</h2>
                    <a href="login.html" class="w-full inline-block bg-blue-600 text-white text-lg font-bold py-3 rounded-lg hover:bg-blue-700 transition shadow-lg mt-4">
                        ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°
                    </a>
                </div>
            </div>

            <!-- â˜… ë¡œê·¸ì¸ í•œ ê²½ìš°: ê²Œì‹œê¸€ ëª©ë¡ (v-else ë³µêµ¬) -->
            <div v-else class="board-container rounded-lg shadow-md animate-fade-in-up overflow-hidden transition-colors duration-300">
                <!-- ê²Œì‹œíŒ í—¤ë” -->
                <div class="board-header flex flex-col md:flex-row justify-between items-center p-5 gap-4 transition-colors duration-300">
                    <h2 class="text-xl font-bold">{{ categoryTitle }}</h2>
                    <div class="flex items-center space-x-2 w-full md:w-auto">
                        <div class="relative flex-grow md:flex-grow-0">
                            <input v-model="searchKeyword" @keyup.enter="fetchPosts" type="text" placeholder="ì œëª© ê²€ìƒ‰..." class="w-full md:w-64 pl-10 pr-4 py-2 rounded-lg transition">
                            <span class="absolute left-3 top-2.5 opacity-50">ğŸ”</span>
                        </div>
                        <button @click="fetchPosts" class="search-btn font-semibold px-4 py-2 rounded-lg transition">ê²€ìƒ‰</button>
                        <button @click="goToWrite" class="bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-700 transition shadow-sm whitespace-nowrap border-0">+ ê¸€ì“°ê¸°</button>
                    </div>
                </div>
                
                <!-- í…Œì´ë¸” -->
                <table class="w-full min-w-full">
                    <thead>
                        <tr>
                            <th class="p-4 text-left text-sm font-semibold w-20">ë²ˆí˜¸</th>
                            <th class="p-4 text-left text-sm font-semibold">ì œëª©</th>
                            <th class="p-4 text-left text-sm font-semibold w-32">ì‘ì„±ì</th>
                            <th class="p-4 text-left text-sm font-semibold w-32">ì‘ì„±ì¼</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-if="posts.length === 0">
                            <td colspan="4" class="p-10 text-center opacity-60">
                                <span v-if="searchKeyword">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
                                <span v-else>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</span>
                            </td>
                        </tr>
                        <tr v-for="(post, index) in posts" :key="post.id" @click="goToDetail(post.id)" class="cursor-pointer transition duration-150">
                            <td class="p-4 text-sub text-sm">{{ index + 1 }}</td>
                            <td class="p-4 font-medium truncate">{{ post.title }}</td>
                            <td class="p-4 text-sub text-sm">{{ post.member ? post.member.username : 'ìµëª…' }}</td>
                            <td class="p-4 text-sub text-sm">{{ formatDate(post.createdAt) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        if (typeof Vue === 'undefined') alert("Vue.js ë¡œë“œ ì‹¤íŒ¨");
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loggedInUser: localStorage.getItem('loggedInUser') || null,
                    posts: [],
                    category: null, 
                    categoryTitle: 'ê²Œì‹œíŒ',
                    searchKeyword: '',
                    currentTheme: 'light',
                    cherryBlossomInterval: null
                }
            },
            mounted() {
                // â˜… í˜ì´ì§€ ë¡œë“œ ì‹œ: ì €ì¥ëœ í…Œë§ˆë¥¼ ë¶ˆëŸ¬ì™€ì„œ bodyì— ì§ì ‘ ì ìš©!
                const savedTheme = localStorage.getItem('userTheme') || 'light';
                this.currentTheme = savedTheme;
                document.body.className = `theme-${savedTheme}`; // í•µì‹¬ ìˆ˜ì • ì‚¬í•­

                if (savedTheme === 'pink') this.startCherryBlossoms();
                
                const params = new URLSearchParams(window.location.search);
                this.category = params.get('category'); 
                this.setCategoryTitle();
                
                // â˜… ë¡œê·¸ì¸ ì²´í¬: ë¡œê·¸ì¸ëœ ê²½ìš°ì—ë§Œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                if (this.loggedInUser) {
                    this.fetchPosts(); 
                }
            },
            methods: {
                async changeTheme(theme) {
                    this.currentTheme = theme;
                    // â˜… í…Œë§ˆ ë³€ê²½ ì‹œ: body í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ë³€ê²½í•´ì•¼ CSSê°€ ë¨¹í™ë‹ˆë‹¤!
                    document.body.className = `theme-${theme}`; // í•µì‹¬ ìˆ˜ì • ì‚¬í•­
                    localStorage.setItem('userTheme', theme);

                    if (theme === 'pink') {
                        this.startCherryBlossoms();
                    } else {
                        if (this.cherryBlossomInterval) {
                            clearInterval(this.cherryBlossomInterval);
                            this.cherryBlossomInterval = null;
                        }
                        const petals = document.querySelectorAll('.cherry-blossom');
                        petals.forEach(p => p.remove());
                    }

                    if (this.loggedInUser) {
                        try {
                            await axios.post('http://localhost:8081/api/theme', {
                                username: this.loggedInUser,
                                theme: theme
                            });
                        } catch (e) { console.warn("í…Œë§ˆ ì €ì¥ ì‹¤íŒ¨:", e); }
                    }
                },
                startCherryBlossoms() {
                    if (this.cherryBlossomInterval) return;
                    this.cherryBlossomInterval = setInterval(this.createPetal, 300);
                },
                createPetal() {
                    const petal = document.createElement('div');
                    petal.classList.add('cherry-blossom');
                    const startLeft = Math.random() * window.innerWidth;
                    const duration = Math.random() * 5 + 5 + 's';
                    const size = Math.random() * 10 + 10 + 'px';
                    petal.style.left = startLeft + 'px';
                    petal.style.animationDuration = duration;
                    petal.style.width = size;
                    petal.style.height = size;
                    document.body.appendChild(petal);
                    setTimeout(() => petal.remove(), parseFloat(duration) * 1000);
                },
                setCategoryTitle() {
                    const titles = { group: 'ğŸ“¢ ê³µë™êµ¬ë§¤', review: 'â­ ì‚¬ìš© í›„ê¸°', recipe: 'ğŸ³ ê¸°ìˆ™ì‚¬ ë ˆì‹œí”¼', tip: 'ğŸ’¡ ìƒí™œ ê¿€íŒ', counseling: 'ğŸ’¬ ê³ ë¯¼ìƒë‹´ì†Œ' };
                    this.categoryTitle = titles[this.category] || 'ê²Œì‹œíŒ';
                },
                async fetchPosts() {
                    if (!this.category) return;
                    try {
                        let url = `http://localhost:8081/api/posts?category=${this.category}`;
                        if (this.searchKeyword.trim()) url += `&keyword=${encodeURIComponent(this.searchKeyword.trim())}`;
                        const response = await axios.get(url);
                        this.posts = response.data;
                    } catch (error) { console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error); }
                },
                logout() {
                    localStorage.removeItem('loggedInUser');
                    try { window.location.href = 'main.html'; } catch(e) {}
                },
                goToWrite() { try { window.location.href = `write.html?category=${this.category}`; } catch (e) {} },
                goToDetail(postId) { try { window.location.href = `detail.html?id=${postId}`; } catch (e) {} },
                formatDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return `${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>