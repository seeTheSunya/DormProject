<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>ê¸€ ìƒì„¸</title>
    <style>
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app">
        <header class="bg-white shadow-sm sticky top-0 z-10">
            <div class="container mx-auto px-6 py-4 flex items-center justify-between">
                <a href="main.html" class="text-2xl font-bold text-gray-800 hover:text-blue-600 transition">ğŸ  ë„ë€</a>
                <div v-if="loggedInUser" class="flex items-center space-x-3">
                    <span class="text-gray-600"><b>{{ loggedInUser }}</b>ë‹˜</span>
                    <button @click="logout" class="bg-gray-200 text-gray-700 font-semibold px-4 py-2 rounded hover:bg-gray-300 transition">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </header>

        <main class="container mx-auto p-4 md:p-6 pb-12">
            <!-- ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš° -->
            <div v-if="!loggedInUser">
                <div class="bg-white p-10 rounded-xl shadow-md max-w-lg w-full mx-auto mt-10 text-center animate-fade-in-up">
                    <div class="text-6xl mb-4">ğŸ”’</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</h2>
                    <a href="login.html" class="w-full inline-block bg-blue-600 text-white text-lg font-bold py-3 rounded-lg hover:bg-blue-700 transition shadow-lg mt-4">
                        ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°
                    </a>
                </div>
            </div>

            <!-- ë¡œë”© ì¤‘ -->
            <div v-if="loggedInUser && isLoading" class="text-center py-20">
                <p class="text-gray-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>

            <!-- ë¡œê·¸ì¸ í•œ ê²½ìš°: ê¸€ ìƒì„¸ ë‚´ìš© -->
            <div v-if="loggedInUser && !isLoading && post" class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden animate-fade-in-up">
                <!-- 1. ì œëª© ì˜ì—­ -->
                <div class="p-6 border-b border-gray-200">
                    <h1 class="text-3xl font-bold text-gray-900 mb-3">{{ post.title }}</h1>
                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                        <span>ì‘ì„±ì: <b class="text-gray-700">{{ post.member ? post.member.username : 'ìµëª…' }}</b></span>
                        <span>|</span>
                        <span>ì‘ì„±ì¼: {{ formatDate(post.createdAt) }}</span>
                    </div>
                </div>
                
                <!-- 2. ë‚´ìš© ì˜ì—­ -->
                <div class="p-6 min-h-[300px]">
                    <!-- (pre íƒœê·¸ë¡œ ê³µë°±ê³¼ ì¤„ë°”ê¿ˆ ìœ ì§€) -->
                    <pre class="text-base text-gray-800 whitespace-pre-wrap font-sans">{{ post.content }}</pre>
                </div>
                
                <!-- 3. ë²„íŠ¼ ì˜ì—­ -->
                <div class="p-4 bg-gray-50 border-t border-gray-200 flex justify-between">
                    <a :href="'board.html?category=' + post.category" class="bg-gray-200 text-gray-700 font-semibold px-5 py-2 rounded-lg hover:bg-gray-300 transition">ëª©ë¡ìœ¼ë¡œ</a>
                    <div>
                        <button class="bg-yellow-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-yellow-600 transition mr-2">ìˆ˜ì •</button>
                        <button class="bg-red-500 text-white font-semibold px-5 py-2 rounded-lg hover:bg-red-600 transition">ì‚­ì œ</button>
                    </div>
                </div>
            </div>
            
             <!-- ì—ëŸ¬ ë°œìƒ ì‹œ -->
            <div v-if="loggedInUser && !isLoading && !post" class="text-center py-20">
                <p class="text-red-500 text-xl">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê¸€ì…ë‹ˆë‹¤.</p>
                <a href="main.html" class="text-blue-600 hover:underline mt-4 inline-block">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>

        </main>
    </div>

    <script>
        const { createApp } = Vue;

        const app = createApp({
            data() {
                return {
                    loggedInUser: localStorage.getItem('loggedInUser') || null,
                    post: null, // ê¸€ ìƒì„¸ ë°ì´í„° (1ê°œ)
                    isLoading: true, // ë¡œë”© ìƒíƒœ
                    postId: null
                }
            },
            mounted() {
                // 1. URLì—ì„œ ê¸€ ID ì½ì–´ì˜¤ê¸°
                const params = new URLSearchParams(window.location.search);
                this.postId = params.get('id'); // ?id=1 -> '1'

                // 2. ë¡œê·¸ì¸ ìƒíƒœê³ , IDê°€ ìˆìœ¼ë©´ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
                if (this.loggedInUser && this.postId) {
                    this.fetchPostDetail();
                } else if (!this.loggedInUser) {
                    this.isLoading = false;
                }
            },
            methods: {
                // â˜… API ìˆ˜ì •: /api/posts/{id} ë¡œ ìš”ì²­
                async fetchPostDetail() {
                    this.isLoading = true;
                    try {
                        const response = await axios.get(`http://localhost:8080/api/posts/${this.postId}`);
                        this.post = response.data;
                    } catch (error) {
                        console.error("ê¸€ ìƒì„¸ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:", error);
                        this.post = null; // ì—ëŸ¬ ì‹œ post ë¹„ìš°ê¸°
                    } finally {
                        this.isLoading = false;
                    }
                },
                logout() {
                    localStorage.removeItem('loggedInUser');
                    this.loggedInUser = null;
                    window.location.href = 'main.html';
                },
                formatDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    // ë…„-ì›”-ì¼ ì‹œ:ë¶„
                    return date.toLocaleString('ko-KR', { 
                        year: 'numeric', month: '2-digit', day: '2-digit', 
                        hour: '2-digit', minute: '2-digit' 
                    });
                }
            }
        });
        
        app.mount('#app');
    </script>
</body>
</html>