<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ë€:ê¸°ìˆ™ì‚¬ ì»¤ë®¤ë‹ˆí‹°</title>
    <!-- Vue.js CDN (ì „ì—­ ë¹Œë“œ) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Axios CDN: ì„œë²„ í†µì‹ ìš© -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <style>
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
        }
        .animate-fade-in-up { animation: fadeInUp 0.3s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        /* ê²Œì‹œê¸€ ë¯¸ë¦¬ë³´ê¸° íŒì—… ìŠ¤íƒ€ì¼ */
        .preview-popup {
            position: absolute;
            left: 50%; 
            transform: translateX(-50%); 
            top: 100%; 
            width: 300px; 
            max-height: 400px;
            overflow-y: auto;
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            z-index: 50;
            display: none; 
            pointer-events: none; 
        }
        
        .post-item:hover .preview-popup {
            display: block;
        }

        .preview-content img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        .preview-content {
            font-size: 0.875rem;
            color: #4b5563;
        }

        /* ë‹¤í¬ëª¨ë“œ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        body.theme-dark .preview-popup {
            background-color: #1f2937;
            border-color: #374151;
            color: #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        body.theme-dark .preview-content {
            color: #d1d5db;
        }

        /* í…Œë§ˆë³„ ìƒ‰ìƒ ì •ì˜ */

		/* 1. ë¼ì´íŠ¸ ëª¨ë“œ (ê¸°ë³¸) */
		body.theme-light { background-color: #f3f4f6; color: #1f2937; }
		body.theme-light .board-section .header { background-color: #ffffff; border-bottom: 1px solid #e5e7eb; }
		body.theme-light .board-section .header a { color: #1f2937; }
		body.theme-light .board-section .header button { color: #9ca3af; }
		/* ìƒë‹¨ í—¤ë” ì»¨íŠ¸ë¡¤ */
		body.theme-light header select { background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
		body.theme-light .logout-btn { background-color: #e5e7eb; color: #374151; }
		body.theme-light .logout-btn:hover { background-color: #d1d5db; }
		body.theme-light .mypage-btn { color: #6b7280; }
		body.theme-light .mypage-btn:hover { color: #3b82f6; }

		/* 2. ë‹¤í¬ ëª¨ë“œ */
		body.theme-dark { background-color: #111827; color: #e5e7eb; }
		body.theme-dark .bg-white { background-color: #1f2937 !important; border-color: #374151; color: #e5e7eb; }
		body.theme-dark .text-gray-800 { color: #f3f4f6 !important; }
		body.theme-dark .text-gray-700 { color: #d1d5db !important; }
		body.theme-dark .text-gray-600 { color: #9ca3af !important; }
		body.theme-dark header { background-color: #1f2937 !important; border-bottom: 1px solid #374151; }
		body.theme-dark .board-section .header { background-color: #374151; }
		body.theme-dark .board-section .header a { color: #ffffff; }
		body.theme-dark .board-section .header button { color: #d1d5db; }
		
		body.theme-dark .popular-section-box { background: linear-gradient(to right, #1f2937, #111827) !important; border-color: #374151 !important; }
		body.theme-dark .popular-card { background-color: #374151 !important; border-color: #4b5563 !important; }
		/* ìƒë‹¨ í—¤ë” ì»¨íŠ¸ë¡¤ */
		body.theme-dark header select { background-color: #374151; color: #e5e7eb; border: 1px solid #4b5563; }
		body.theme-dark .logout-btn { background-color: #374151; color: #e5e7eb; border: 1px solid #4b5563; }
		body.theme-dark .logout-btn:hover { background-color: #4b5563; }
		body.theme-dark .mypage-btn { color: #9ca3af; }
		body.theme-dark .mypage-btn:hover { color: #60a5fa; }
		/* ë‹¤í¬ëª¨ë“œ ê²Œì‹œê¸€ í˜¸ë²„: ë°°ê²½ìƒ‰ ë³€ê²½ ì—†ì´ ê¸€ì”¨ìƒ‰ë§Œ ë³€ê²½ */
		body.theme-dark .post-list li:hover { background-color: transparent !important; }
		body.theme-dark .post-list li:hover .text-gray-800 { color: #60a5fa !important; }

		/* 3. ë¯¼íŠ¸ ëª¨ë“œ */
		body.theme-blue { background-color: #f7faf9; color: #5a7a72; }
		body.theme-blue header { background-color: #eaf5f2 !important; }
		body.theme-blue .board-section .header { background-color: #5a7a72; }
		body.theme-blue .board-section .header a { color: #ffffff; }
		body.theme-blue .board-section .header button { color: #e5e7eb; }
		/* ìƒë‹¨ í—¤ë” ì»¨íŠ¸ë¡¤ - ë°°ê²½ìƒ‰(#eaf5f2)ê³¼ ì–´ìš¸ë¦¬ëŠ” ë””ìì¸ */
		body.theme-blue header select { background-color: #ffffff; color: #5a7a72; border: 1px solid #bce3d4; }
		body.theme-blue .logout-btn { background-color: #ffffff; color: #5a7a72; border: 1px solid #bce3d4; }
		body.theme-blue .logout-btn:hover { background-color: #d1fae5; }
		body.theme-blue .mypage-btn { color: #5a7a72; }
		body.theme-blue .mypage-btn:hover { color: #3e5c54; }
		/* ë¯¼íŠ¸ í…Œë§ˆ ì¸ê¸°ê¸€ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
		body.theme-blue .popular-section-box { background: linear-gradient(to right, #e0f2f1, #b2dfdb) !important; border-color: #80cbc4 !important; }
		body.theme-blue .popular-section-box h2 { color: #00695c !important; }
		body.theme-blue .popular-card { border-color: #b2dfdb !important; }
		body.theme-blue .popular-card span.bg-orange-500 { background-color: #26a69a !important; }

		/* 4. ì½”ë„ ëª¨ë“œ */
		body.theme-pink { background-color: #fef5f0; color: #b85d4a; }
		body.theme-pink header { background-color: #fce8df !important; }
		body.theme-pink .board-section .header { background-color: #d66a58; }
		body.theme-pink .board-section .header a { color: #ffffff; }
		body.theme-pink .board-section .header button { color: #e5e7eb; }
		/* ìƒë‹¨ í—¤ë” ì»¨íŠ¸ë¡¤ - ë°°ê²½ìƒ‰(#fce8df)ê³¼ ì–´ìš¸ë¦¬ëŠ” ë””ìì¸ */
		body.theme-pink header select { background-color: #ffffff; color: #b85d4a; border: 1px solid #fed7aa; }
		body.theme-pink .logout-btn { background-color: #ffffff; color: #b85d4a; border: 1px solid #fecaca; }
		body.theme-pink .logout-btn:hover { background-color: #ffe4e6; }
		body.theme-pink .mypage-btn { color: #b85d4a; }
		body.theme-pink .mypage-btn:hover { color: #9c4232; }

        /* â˜…â˜…â˜… [ë³µêµ¬] ë²šê½ƒ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ â˜…â˜…â˜… */
        .cherry-blossom {
            position: fixed;
            top: -10px;
            background-color: #FFB7C5; /* ë²šê½ƒìƒ‰ */
            border-radius: 150% 0 150% 0; /* ê½ƒì ëª¨ì–‘ */
            pointer-events: none; /* í´ë¦­ ë°©í•´ ê¸ˆì§€ */
            z-index: 9999;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0deg) translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg) translateX(50px);
                opacity: 0;
            }
        }
    </style>
</head>
<body :class="'theme-' + currentTheme">
    <div id="app">
        <div class="min-h-screen font-sans transition-colors duration-300">
            <!-- ìƒë‹¨ í—¤ë” -->
            <header class="bg-white shadow-sm sticky top-0 z-10 transition-colors duration-300">
                <div class="container mx-auto px-6 py-4 flex items-center justify-between">
                    <div class="flex items-center cursor-pointer" @click="fetchPosts" style="margin-left: -60px;">
                        <img src="/assets/doran-logo2.png" alt="ë„ë€ ë¡œê³ " style="height: 49px; object-fit: contain;" onerror="this.style.display='none';">
                        <span class="text-xs text-gray-600 ml-2 font-bold" style="font-size: 12px; white-space: nowrap; font-weight: 700; margin-top: 30px;">ê¸°ìˆ™ì‚¬ìƒë“¤ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹°</span>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- í…Œë§ˆ ì„ íƒ -->
                        <select v-model="currentTheme" @change="changeTheme(currentTheme)" 
                                class="p-1 border rounded text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white/80 cursor-pointer transition-colors">
                            <option value="light">ğŸŒ ë¼ì´íŠ¸</option>
                            <option value="dark">ğŸŒ™ ë‹¤í¬</option>
                            <option value="blue">ğŸŒ¿ ë¯¼íŠ¸</option>
                            <option value="pink">ğŸŒ¸ ë²šê½ƒ</option>
                        </select>

                        <!-- ë¡œê·¸ì¸ ìƒíƒœ -->
                        <div v-if="loggedInUser" class="flex items-center space-x-3">
                            <span class="text-gray-600 text-sm"><b>{{ loggedInUser }}</b>ë‹˜</span>
                            <button @click="goToMyPage" class="text-gray-500 font-semibold hover:text-blue-600 transition mr-2 text-sm">
                                ë§ˆì´í˜ì´ì§€
                            </button>
							<button @click="logout" class="logout-btn font-semibold px-4 py-2 rounded transition text-sm">ë¡œê·¸ì•„ì›ƒ</button>
							                       </div>
							                       <button v-else @click="goToLogin" class="text-white font-semibold px-4 py-2 rounded transition hover:opacity-90" style="background-color: #D66A58;">
							                           ë¡œê·¸ì¸
							                       </button>
                    </div>
                </div>
            </header>

            <main class="container mx-auto p-4 md:p-6 pb-12">
                <!-- 1. ë¡œê·¸ì¸ ì ê¸ˆ í™”ë©´ -->
                <div v-if="!loggedInUser" class="flex flex-col items-center justify-center py-20 text-center animate-fade-in-up">
                    <div class="bg-white p-10 rounded-xl shadow-md max-w-lg w-full">
                        <div class="text-6xl mb-4">ğŸ”’</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</h2>
                        <p class="text-gray-600 mb-8">ê¸°ìˆ™ì‚¬ìƒë“¤ê³¼ ì†Œí†µí•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”.</p>
                        <button @click="goToLogin" class="w-full text-white text-lg font-bold py-3 rounded-lg transition shadow-lg hover:opacity-90" style="background-color: #D66A58;">
                            ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°
                        </button>
                    </div>
                </div>

                <!-- 2. ë¡œê·¸ì¸ í›„: ëŒ€ì‹œë³´ë“œ -->
                <div v-else class="animate-fade-in-up">

                    <!-- ì‹¤ì‹œê°„ ì¸ê¸°ê¸€ ì„¹ì…˜ (ë¯¸ë¦¬ë³´ê¸° ì ìš©) -->
                    <div class="popular-section-box mb-8 bg-gradient-to-r from-orange-100 to-yellow-50 rounded-xl p-6 border border-orange-200 shadow-sm transition-colors duration-300">
                        <h2 class="text-xl font-bold text-orange-600 mb-4 flex items-center transition-colors">
                            ğŸ”¥ ì´ë²ˆ ì£¼ ì‹¤ì‹œê°„ ì¸ê¸°ê¸€
                            <span class="text-sm font-normal text-gray-500 ml-2 transition-colors">(ìµœê·¼ 7ì¼ ê¸°ì¤€)</span>
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- ì¸ê¸°ê¸€ ì¹´ë“œ -->
                            <div v-for="(post, index) in popularPosts" :key="post.id" 
                                 @click="goToDetail(post.id)"
                                 class="post-item popular-card bg-white p-4 rounded-lg shadow-sm border border-orange-100 cursor-pointer hover:shadow-md transition transform hover:-translate-y-1 relative">
                                
                                <div class="flex justify-between items-start mb-2">
                                    <span class="bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded-full">{{ index + 1 }}ìœ„</span>
                                    <span class="text-xs text-gray-500 transition-colors">{{ formatDate(post.createdAt) }}</span>
                                </div>
                                <h3 class="font-bold text-gray-800 truncate mb-1 transition-colors">{{ post.title }}</h3>
                                <div class="flex justify-between items-center text-sm">
                                    <span class="text-gray-500 transition-colors">{{ post.member ? post.member.username : 'ìµëª…' }}</span>
                                    <span class="text-red-500 font-semibold">â™¥ {{ post.likeCount }}</span>
                                </div>

                                <!-- ë¯¸ë¦¬ë³´ê¸° íŒì—… (ì¸ê¸°ê¸€) -->
                                <div class="preview-popup custom-scrollbar">
                                    <h4 class="font-bold mb-2 text-sm truncate">{{ post.title }}</h4>
                                    <div class="preview-content" v-html="post.content"></div>
                                </div>
                            </div>
                            <!-- ì¸ê¸°ê¸€ ì—†ì„ ë•Œ -->
                            <div v-if="popularPosts.length === 0" class="col-span-3 text-center text-gray-500 py-4 transition-colors">
                                ì•„ì§ ì¸ê¸°ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ì¸ê¸°ê¸€ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”!
                            </div>
                        </div>
                    </div>

                    <!-- ê²Œì‹œíŒ ëª©ë¡ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <board-section title="ğŸ“¢ ê³µë™êµ¬ë§¤ ê²Œì‹œíŒ" category-code="group" :posts="groupPurchasePosts" @add-post="goToWrite" @go-detail="goToDetail"></board-section>
                        <board-section title="â­ ì‚¬ìš© í›„ê¸° ê²Œì‹œíŒ" category-code="review" :posts="reviewPosts" @add-post="goToWrite" @go-detail="goToDetail"></board-section>
                        <board-section title="ğŸ³ ê¸°ìˆ™ì‚¬ ë ˆì‹œí”¼" category-code="recipe" :posts="recipePosts" @add-post="goToWrite" @go-detail="goToDetail"></board-section>
                        <board-section title="ğŸ’¡ ìƒí™œ ê¿€íŒ" category-code="tip" :posts="tipPosts" @add-post="goToWrite" @go-detail="goToDetail"></board-section>
                        <board-section title="ğŸ’¬ ê³ ë¯¼ìƒë‹´ì†Œ" category-code="counseling" :posts="counselingPosts" class="md:col-span-2" @add-post="goToWrite" @go-detail="goToDetail"></board-section>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Vue ë¡œë“œ í™•ì¸
        if (typeof Vue === 'undefined') {
            alert("Vue.js ë¡œë“œ ì‹¤íŒ¨. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.");
        } else {
            const { createApp } = Vue;

			const BoardSection = {
			    props: ['title', 'posts', 'categoryCode'],
			    emits: ['add-post', 'go-detail'], 
			    template: `
			    <div class="board-section bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition duration-200">
			        <div class="header flex justify-between items-center p-4 border-b border-gray-200 rounded-t-lg transition-colors duration-300">
			            <a :href="'board.html?category=' + categoryCode" 
			               class="text-lg font-bold hover:text-blue-400 transition">{{ title }}</a>
			            <button @click="$emit('add-post', categoryCode)" class="text-2xl font-light hover:text-blue-400 transition transform hover:scale-110 cursor-pointer" title="ìƒˆ ê¸€ ì“°ê¸°">+</button>
			        </div>
			        <ul class="post-list p-4 space-y-3">
			            <li v-for="post in posts.slice(0, 5)" 
			                :key="post.id" 
			                @click="$emit('go-detail', post.id)" 
			                class="flex justify-between items-center text-sm group cursor-pointer hover:bg-gray-50 p-1 rounded">
			                
			                <span class="text-gray-800 group-hover:text-blue-600 truncate pr-4 font-medium">{{ post.title }}</span>
			                <span class="text-gray-400 text-xs flex-shrink-0">{{ formatDate(post.createdAt) }}</span>
			            </li>
			            <li v-if="!posts || posts.length === 0" class="text-center text-gray-400 py-6 text-sm">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
			        </ul>
			    </div>
			    `,
			    methods: {
			        formatDate(dateString) {
			            if (!dateString) return '';
			            const date = new Date(dateString);
			            return `${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
			        }
			    }
			};

            const app = createApp({
                data() {
                    return {
                        loggedInUser: localStorage.getItem('loggedInUser') || null,
                        currentTheme: 'light',
                        groupPurchasePosts: [], reviewPosts: [], recipePosts: [], tipPosts: [], counselingPosts: [],
                        popularPosts: [],
                        // â˜… ë²šê½ƒ íš¨ê³¼ ì¸í„°ë²Œ ë³€ìˆ˜ ì¶”ê°€
                        cherryBlossomInterval: null
                    }
                },
                mounted() {
                    const savedTheme = localStorage.getItem('userTheme');
                    if (savedTheme) {
                        this.changeTheme(savedTheme);
                    }
                    if (this.loggedInUser) {
                        this.fetchPosts();
                        this.fetchPopularPosts(); 
                    }
                },
                methods: {
                    async changeTheme(theme) {
                        this.currentTheme = theme;
                        document.body.className = `theme-${theme}`; 
                        localStorage.setItem('userTheme', theme);

                        // â˜… ë²šê½ƒ í…Œë§ˆì¼ ë•Œ íš¨ê³¼ ì‹œì‘, ì•„ë‹ˆë©´ ì •ì§€
                        if (theme === 'pink') {
                            this.startCherryBlossoms();
                        } else {
                            this.stopCherryBlossoms();
                        }

                        if (this.loggedInUser) {
                            try { await axios.post('/api/theme', { username: this.loggedInUser, theme: theme }); } catch (e) {}
                        }
                    },
                    
                    // â˜… ë²šê½ƒ ìƒì„± ë¡œì§ ë³µêµ¬
                    startCherryBlossoms() {
                        if (this.cherryBlossomInterval) return;
                        this.cherryBlossomInterval = setInterval(this.createPetal, 300);
                    },
                    stopCherryBlossoms() {
                        if (this.cherryBlossomInterval) {
                            clearInterval(this.cherryBlossomInterval);
                            this.cherryBlossomInterval = null;
                        }
                        document.querySelectorAll('.cherry-blossom').forEach(petal => petal.remove());
                    },
                    createPetal() {
                        const petal = document.createElement('div');
                        petal.classList.add('cherry-blossom');
                        const startLeft = Math.random() * window.innerWidth;
                        const duration = Math.random() * 5 + 5 + 's';
                        const size = Math.random() * 10 + 10 + 'px';
                        petal.style.left = startLeft + 'px';
                        petal.style.animationDuration = duration;
                        petal.style.width = size;
                        petal.style.height = size;
                        document.body.appendChild(petal);
                        setTimeout(() => { petal.remove(); }, parseFloat(duration) * 1000);
                    },

                    async fetchPopularPosts() {
                        try {
                            const response = await axios.get('/api/posts/popular');
                            this.popularPosts = response.data;
                        } catch (e) { console.error("ì¸ê¸°ê¸€ ë¡œë“œ ì‹¤íŒ¨:", e); }
                    },
                    async fetchPosts() {
                        try {
                            const response = await axios.get('/api/posts');
                            const allPosts = response.data;
                            
                            const sortByDate = (a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0);

                            this.groupPurchasePosts = allPosts.filter(p => p.category === 'group').sort(sortByDate);
                            this.reviewPosts = allPosts.filter(p => p.category === 'review').sort(sortByDate);
                            this.recipePosts = allPosts.filter(p => p.category === 'recipe').sort(sortByDate);
                            this.tipPosts = allPosts.filter(p => p.category === 'tip').sort(sortByDate);
                            this.counselingPosts = allPosts.filter(p => p.category === 'counseling').sort(sortByDate);
                        } catch (error) { console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error); }
                    },
                    goToLogin() { 
                        try { window.location.href = 'login.html'; } catch(e) {}
                    },
                    goToMyPage() {
                        try { window.location.href = 'mypage.html'; } catch(e) {}
                    },
                    goToWrite(categoryCode) {
                        try {
                            window.location.href = `write.html?category=${categoryCode}`;
                        } catch (e) { console.warn(e); }
                    },
                    goToDetail(postId) { 
                        try { 
                            window.location.href = `detail.html?id=${postId}`; 
                        } catch(e) { console.warn(e); }
                    },
                    logout() {
                        localStorage.removeItem('loggedInUser');
                        this.loggedInUser = null;
                        this.groupPurchasePosts = [];
                        alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        try { location.reload(); } catch(e) {}
                    },
                    formatDate(dateString) {
                        if (!dateString) return '';
                        const date = new Date(dateString);
                        return `${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
                    }
                }
            });

            app.component('board-section', BoardSection);
            app.mount('#app');
        }
    </script>
</body>
</html>